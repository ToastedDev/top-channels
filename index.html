<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Top YouTube Channels</title>

    <link
      rel="icon"
      href="https://api.communitrics.com/youtube/profile?channel=communitrics"
      type="image/png"
    />

    <meta property="og:title" content="Top YouTube Channels" />
    <meta
      property="og:description"
      content="Explore and analyze the most popular YouTube channels"
    />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Top YouTube Channels" />
    <meta
      name="twitter:description"
      content="Explore and analyze the most popular YouTube channels"
    />

    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <style>
      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, Helvetica, Arial, sans-serif;
        background-color: #20222d;
        color: #f3f4f6;
      }

      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: #2b2d38;
      }

      ::-webkit-scrollbar-thumb {
        background-color: #4b5563;
        border-radius: 4px;
      }

      .hover-scale {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .hover-scale:hover {
        transform: translateY(-4px) scale(1.02);
        box-shadow: 0 8px 16px -2px rgba(0, 0, 0, 0.3);
      }

      @keyframes fadeInModal {
        0% {
          opacity: 0;
          transform: scale(0.95);
        }

        100% {
          opacity: 1;
          transform: scale(1);
        }
      }

      #channelModal.show .modal-container {
        animation: fadeInModal 0.3s ease forwards;
      }

      #channelModal.hidden {
        display: none;
      }

      #channelModal.show {
        display: flex;
      }
    </style>
  </head>

  <body class="min-h-screen flex flex-col">
    <header class="relative">
      <div
        class="bg-gradient-to-r from-red-700 to-red-800 text-white py-8 sm:py-12"
      >
        <div class="max-w-7xl mx-auto px-4 sm:px-6 text-center">
          <h1 class="text-2xl sm:text-3xl md:text-4xl font-extrabold">
            <i class="fab fa-youtube mr-2"></i> Top YouTube Channels
          </h1>
          <p
            class="mt-2 text-xs sm:text-sm md:text-base text-red-100 max-w-md mx-auto"
          >
            Explore and analyze the most popular YouTube channels
          </p>
        </div>
      </div>

      <div class="relative">
        <svg
          class="block w-full h-2 sm:h-4 md:h-6"
          preserveAspectRatio="none"
          viewBox="0 0 1440 320"
        >
          <defs>
            <linearGradient
              id="topWaveGradient"
              x1="0%"
              y1="0%"
              x2="100%"
              y2="0%"
            >
              <stop offset="0%" style="stop-color: #c81e1e; stop-opacity: 1" />
              <stop
                offset="100%"
                style="stop-color: #9e1c2b; stop-opacity: 1"
              />
            </linearGradient>
          </defs>
          <path
            fill="url(#topWaveGradient)"
            fill-opacity="1"
            d="M0,192L48,165.3C96,139,192,85,288,85.3C384,85,480,139,576,154.7C672,171,768,149,864,138.7C960,128,1056,128,1152,160C1248,192,1344,256,1392,288L1440,320L1440,0L1392,0C1344,0,1248,0,1152,0C1056,0,960,0,864,0C768,0,672,0,576,0C480,0,384,0,288,0C192,0,96,0,48,0L0,0Z"
          ></path>
        </svg>
      </div>
    </header>

    <section>
      <div class="max-w-7xl mx-auto px-4 sm:px-6">
        <div
          class="rounded-xl shadow-md p-4 flex flex-wrap items-center justify-between gap-4 bg-gradient-to-r from-gray-800 to-gray-700 bg-opacity-95"
        >
          <div
            class="flex flex-wrap items-center gap-4 flex-grow text-gray-100"
          >
            <div class="relative flex-1 min-w-[150px]">
              <input
                type="text"
                id="searchInput"
                placeholder="Search channels..."
                class="w-full pl-10 pr-4 py-2 rounded-md border border-gray-600 focus:border-red-500 focus:ring-2 focus:ring-red-300 focus:outline-none text-sm bg-gray-700 placeholder-gray-400 text-gray-100 shadow-sm transition duration-300"
              />
              <i
                class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-300"
              ></i>
            </div>

            <div class="flex-1 min-w-[120px]">
              <select
                id="filterSubSelect"
                class="w-full px-3 py-2 border border-gray-600 rounded-md text-sm focus:border-red-500 focus:ring-2 focus:ring-red-300 focus:outline-none bg-gray-700 text-gray-100 placeholder-gray-400 shadow-sm transition duration-300"
              >
                <option value="all">All Channels</option>
                <option value="100m">100M+ Subs</option>
                <option value="50m">50M+ Subs</option>
                <option value="20m">20M+ Subs</option>
                <option value="10m">10M+ Subs</option>
              </select>
            </div>

            <div class="flex-1 min-w-[120px]">
              <select
                id="sortSelect"
                class="w-full px-3 py-2 border border-gray-600 rounded-md text-sm focus:border-red-500 focus:ring-2 focus:ring-red-300 focus:outline-none bg-gray-700 text-gray-100 placeholder-gray-400 shadow-sm transition duration-300"
              >
                <option value="subs-desc">Sort: Subs (High → Low)</option>
                <option value="subs-asc">Sort: Subs (Low → High)</option>
                <option value="views-desc">Sort: Views (High → Low)</option>
                <option value="views-asc">Sort: Views (Low → High)</option>
              </select>
            </div>

            <div class="flex-1 min-w-[120px]">
              <select
                id="displayCountSelect"
                class="w-full px-3 py-2 border border-gray-600 rounded-md text-sm focus:border-red-500 focus:ring-2 focus:ring-red-300 focus:outline-none bg-gray-700 text-gray-100 placeholder-gray-400 shadow-sm transition duration-300"
              >
                <option value="10">Show 10 Channels</option>
                <option value="50">Show 50 Channels</option>
                <option value="100">Show 100 Channels</option>
                <option value="500">Show 500 Channels</option>
                <option value="1000">Show 1,000 Channels</option>
              </select>
            </div>
          </div>

          <div class="flex-none">
            <button
              id="downloadCSV"
              class="inline-flex items-center bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-md shadow-md transition duration-300 text-sm transform hover:scale-105"
            >
              <i class="fas fa-download mr-2"></i>
              Download CSV
            </button>
          </div>
        </div>
      </div>
    </section>

    <main class="flex-grow w-full">
      <section class="max-w-7xl mx-auto px-4 sm:px-6 py-8">
        <p
          id="totalChannels"
          class="text-gray-300 text-sm mb-4 font-medium tracking-wide"
        >
          Total Channels: 0
        </p>

        <div
          id="channelList"
          class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"
        ></div>
      </section>
    </main>

    <footer
      class="relative bg-gradient-to-r from-gray-900 to-gray-800 text-gray-200 mt-auto"
    >
      <div class="w-full h-16 bg-transparent relative">
        <svg
          class="absolute top-0 left-0 w-full h-full"
          viewBox="0 0 1440 320"
          preserveAspectRatio="none"
        >
          <defs>
            <linearGradient
              id="bottomWaveGradient"
              x1="0%"
              y1="0%"
              x2="100%"
              y2="0%"
            >
              <stop offset="0%" style="stop-color: #20222d; stop-opacity: 1" />
              <stop
                offset="100%"
                style="stop-color: #20222d; stop-opacity: 1"
              />
            </linearGradient>
          </defs>
          <path
            fill="url(#bottomWaveGradient)"
            fill-opacity="1"
            d="M0,192L48,165.3C96,139,192,85,288,85.3C384,85,480,139,576,154.7C672,171,768,149,864,138.7C960,128,1056,128,1152,160C1248,192,1344,256,1392,288L1440,320L1440,0L1392,0C1344,0,1248,0,1152,0C1056,0,960,0,864,0C768,0,672,0,576,0C480,0,384,0,288,0C192,0,96,0,48,0L0,0Z"
          ></path>
        </svg>
      </div>

      <div class="max-w-7xl mx-auto px-4 sm:px-6 py-6 text-center">
        <p class="text-xs sm:text-sm text-gray-400">
          Made by
          <a
            href="https://twitter.com/charlieashfordd"
            target="_blank"
            class="underline hover:text-red-400"
            >Charlie</a
          >
        </p>
      </div>
    </footer>

    <div
      id="channelModal"
      class="fixed inset-0 hidden items-center justify-center z-50 bg-black bg-opacity-60 backdrop-blur-sm"
    >
      <div
        class="relative bg-gray-800 rounded-xl shadow-xl w-full max-w-xl mx-4 sm:mx-auto p-0 modal-container overflow-hidden"
        style="margin-top: 5vh"
      >
        <div class="relative bg-[#3C3E4A] px-6 py-4 flex items-center">
          <div
            id="modalHeader"
            class="flex-1 flex items-center space-x-4 text-gray-100"
          ></div>
          <button
            id="closeModal"
            class="absolute top-4 right-4 text-gray-300 hover:text-gray-100 transition"
          >
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>

        <div id="modalBody" class="px-6 py-4 text-gray-200"></div>

        <div
          class="bg-[#3C3E4A] px-6 py-3 flex justify-end border-t border-gray-600"
        >
          <a
            id="visitChannelBtn"
            href="#"
            target="_blank"
            class="inline-flex items-center bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-md shadow-md transition duration-300 transform hover:scale-105"
          >
            <i class="fab fa-youtube mr-2"></i>
            Visit Channel
          </a>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const searchInput = document.getElementById("searchInput");
        const filterSubSelect = document.getElementById("filterSubSelect");
        const sortSelect = document.getElementById("sortSelect");
        const displayCountSelect =
          document.getElementById("displayCountSelect");
        const channelList = document.getElementById("channelList");
        const totalChannels = document.getElementById("totalChannels");
        const downloadButton = document.getElementById("downloadCSV");

        const channelModal = document.getElementById("channelModal");
        const closeModalBtn = document.getElementById("closeModal");
        const modalHeader = document.getElementById("modalHeader");
        const modalBody = document.getElementById("modalBody");
        const visitChannelBtn = document.getElementById("visitChannelBtn");

        let channels = [];
        let countryMap = {};
        let totalPages = 0;
        let currentPage = 1;

        async function fetchCountryNames() {
          try {
            const response = await axios.get(
              "https://restcountries.com/v3.1/all"
            );
            const map = {};
            response.data.forEach((country) => {
              if (country.cca2) {
                map[country.cca2] = country.name.common;
              }
            });
            return map;
          } catch (error) {
            console.error("Error fetching country names:", error);
            return {};
          }
        }

        async function fetchChannels(page = 1) {
          const size = parseInt(displayCountSelect.value, 10);
          try {
            const response = await axios.get(
              `https://api.communitrics.com/api/top-channels?page=${page}&size=${size}`
            );
            channels = response.data.channels;
            totalPages = response.data.totalPages;
            currentPage = response.data.currentPage;

            const sortedBySubs = [...channels].sort(
              (a, b) => b.sub_num - a.sub_num
            );
            sortedBySubs.forEach((ch, i) => {
              ch.overallRank = i + 1;
            });

            renderChannels();
          } catch (error) {
            console.error("Error fetching channels:", error);
          }
        }

        function renderChannels() {
          const searchValue = searchInput.value.toLowerCase();
          const subFilter = filterSubSelect.value;
          const sortValue = sortSelect.value;

          let filtered = channels.filter((ch) => {
            const matchSearch = ch.title.toLowerCase().includes(searchValue);

            let matchSubs = true;
            switch (subFilter) {
              case "100m":
                matchSubs = ch.sub_num >= 100000000;
                break;
              case "50m":
                matchSubs = ch.sub_num >= 50000000;
                break;
              case "20m":
                matchSubs = ch.sub_num >= 20000000;
                break;
              case "10m":
                matchSubs = ch.sub_num >= 10000000;
                break;
              default:
                matchSubs = true;
            }

            return matchSearch && matchSubs;
          });

          filtered.sort((a, b) => {
            switch (sortValue) {
              case "subs-desc":
                return b.sub_num - a.sub_num;
              case "subs-asc":
                return a.sub_num - b.sub_num;
              case "views-desc":
                return b.view_num - a.view_num;
              case "views-asc":
                return a.view_num - b.view_num;
              default:
                return 0;
            }
          });

          channelList.innerHTML = "";

          filtered.forEach((channel) => {
            const countryName = countryMap[channel.country_code] || "Unknown";

            const card = document.createElement("div");
            card.className = `
            bg-gray-700 rounded-xl shadow-sm
            transition duration-300 cursor-pointer p-4
            border border-gray-600 flex flex-col hover-scale
          `;

            card.innerHTML = `
            <div class="flex items-center mb-3">
              <img
                src="${channel.avatar}"
                alt="${channel.title}"
                class="w-16 h-16 rounded-full mr-4 object-cover"
              />
              <div class="text-gray-100">
                <h3 class="text-base font-bold">
                  #${channel.overallRank} <span class="hover:text-red-400">${
              channel.title
            }</span>
                </h3>
                <p class="text-xs text-gray-300 mt-1">ID: ${channel.id}</p>
              </div>
            </div>
            <div class="space-y-1 text-sm text-gray-200">
              <p>
                <i class="fas fa-user-friends text-red-400 mr-1"></i>
                <span class="font-semibold">Subscribers:</span>
                ${channel.sub_num.toLocaleString()}
              </p>
              <p>
                <i class="fas fa-eye text-red-400 mr-1"></i>
                <span class="font-semibold">Total Views:</span>
                ${channel.view_num.toLocaleString()}
              </p>
              <p>
                <i class="fas fa-globe text-red-400 mr-1"></i>
                <span class="font-semibold">Country:</span>
                ${countryName}
              </p>
            </div>
          `;

            card.addEventListener("click", () =>
              openModal({
                overallRank: channel.overallRank,
                avatar: channel.avatar,
                title: channel.title,
                id: channel.id,
                subscribers: channel.sub_num,
                views: channel.view_num,
                country: countryName,
              })
            );

            channelList.appendChild(card);
          });

          totalChannels.textContent = `Total Channels: ${filtered.length.toLocaleString()}`;
        }

        function openModal(ch) {
          const {
            overallRank,
            avatar,
            title,
            id,
            subscribers,
            views,
            country,
          } = ch;

          modalHeader.innerHTML = `
          <img
            src="${avatar}"
            alt="${title}"
            class="w-14 h-14 rounded-full object-cover"
          />
          <div>
            <h3 class="text-lg font-bold">
              #${overallRank} – ${title}
            </h3>
            <p class="text-xs text-gray-300 mt-1">
              Channel ID: ${id}
            </p>
          </div>
        `;

          modalBody.innerHTML = `
          <div class="space-y-3 mt-2">
            <p>
              <i class="fas fa-user-friends text-red-400 mr-1"></i>
              <span class="font-semibold">Subscribers:</span>
              ${subscribers.toLocaleString()}
            </p>
            <p>
              <i class="fas fa-eye text-red-400 mr-1"></i>
              <span class="font-semibold">Total Views:</span>
              ${views.toLocaleString()}
            </p>
            <p>
              <i class="fas fa-globe text-red-400 mr-1"></i>
              <span class="font-semibold">Country:</span>
              ${country}
            </p>
          </div>
        `;

          visitChannelBtn.setAttribute(
            "href",
            `https://www.youtube.com/channel/${id}`
          );

          channelModal.classList.remove("hidden");
          channelModal.classList.add("show");
        }

        function closeModal() {
          channelModal.classList.remove("show");
          channelModal.classList.add("hidden");
        }

        closeModalBtn.addEventListener("click", closeModal);
        channelModal.addEventListener("click", (e) => {
          if (e.target === channelModal) {
            closeModal();
          }
        });

        function downloadCSV() {
          const csvContent = [
            [
              "Overall Rank",
              "Channel ID",
              "Channel Name",
              "Subscribers",
              "Views",
              "Country",
              "Profile Picture URL",
            ],
            ...channels.map((ch) => [
              ch.overallRank,
              ch.id,
              ch.title.replace(/[",]/g, ""),
              ch.sub_num,
              ch.view_num,
              countryMap[ch.country_code] || "Unknown",
              ch.avatar,
            ]),
          ]
            .map((row) => row.join(","))
            .join("\n");

          const blob = new Blob([csvContent], {
            type: "text/csv;charset=utf-8;",
          });
          const link = document.createElement("a");
          const url = URL.createObjectURL(blob);
          link.setAttribute("href", url);
          link.setAttribute("download", "youtube_channels.csv");
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        }

        async function init() {
          countryMap = await fetchCountryNames();
          await fetchChannels();

          searchInput.addEventListener("input", renderChannels);
          filterSubSelect.addEventListener("change", renderChannels);
          sortSelect.addEventListener("change", renderChannels);
          displayCountSelect.addEventListener("change", fetchChannels);
          downloadButton.addEventListener("click", downloadCSV);
        }

        init();
      });
    </script>
  </body>
</html>
